{
    "name": "ShaderLab",
    "scopeName": "source.shaderlab",
    "patterns": [
        {
            "include": "#structFieldDefine"
        },
        {
            "include": "#hlsl-embedded"
        },
        {
            "name": "storage.type.structure.shaderlab",
            "match": "\\b(?i:Shader|SubShader|Pass|Category)\\b"
        },
        {
            "name": "support.type.propertyname.shaderlab",
            "match": "\\b(?i:Name|Tags|Fallback|CustomEditor|Cull|ZWrite|ZTest|Offset|Blend|BlendOp|ColorMask|AlphaToMask|LOD|Lighting|Stencil|Ref|ReadMask|WriteMask|Comp|CompBack|CompFront|Fail|ZFail|UsePass|GrabPass|Dependency|Material|Diffuse|Ambient|Shininess|Specular|Emission|Fog|Mode|Density|SeparateSpecular|SetTexture|Combine|ConstantColor|Matrix|AlphaTest|ColorMaterial|BindChannels|Bind)\\b"
        },
        {
            "name": "meta.Properties.block",
            "begin": "(Properties)",
            "beginCaptures": {
                "1": {
                    "name": "storage.type.structure.shaderlab"
                }
            },
            "end": "( +})",
            "patterns": [
                {
                    "include": "#comments"
                },
                {
                    "include": "#numbers"
                },
                {
                    "include": "#strings"
                },
                {
                    "name": "support.type.basic.shaderlab",
                    "match": "\\b(?i:Range|Float|Int|Color|Vector|2D|2DArray|3D|Cube|Any)\\b"
                },
                {
                    "name": "support.variable.declaration.shaderlab",
                    "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\("
                },
                {
                    "begin": "\\[([a-zA-Z]+)",
                    "beginCaptures": {
                        "1": {
                            "name": "support.type.attributename.shaderlab"
                        }
                    },
                    "end": "\\]",
                    "patterns": [
                        {
                            "name": "support.parameters.attribute.shaderlab",
                            "begin": "\\(",
                            "end": "\\)",
                            "patterns": [
                                {
                                    "name": "string.quoted.double.shaderlab",
                                    "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
                                },
                                {
                                    "include": "#numbers"
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "support.constant.property-value.shaderlab",
            "match": "\\b(?i:Back|Front|On|Off|[RGBA]{1,3}|AmbientAndDiffuse|Emission)\\b"
        },
        {
            "name": "support.constant.property-value.comparisonfunction.shaderlab",
            "match": "\\b(?i:Less|Greater|LEqual|GEqual|Equal|NotEqual|Always|Never)\\b"
        },
        {
            "name": "support.constant.property-value.stenciloperation.shaderlab",
            "match": "\\b(?i:Keep|Zero|Replace|IncrSat|DecrSat|Invert|IncrWrap|DecrWrap)\\b"
        },
        {
            "name": "support.constant.property-value.blendfactors.shaderlab",
            "match": "\\b(?i:One|Zero|SrcColor|SrcAlpha|DstColor|DstAlpha|OneMinusSrcColor|OneMinusSrcAlpha|OneMinusDstColor|OneMinusDstAlpha)\\b"
        },
        {
            "name": "meta.cgblock",
            "begin": "\\b(CGPROGRAM|CGINCLUDE)\\b",
            "beginCaptures": {
                "1": {
                    "name": "keyword.other"
                }
            },
            "end": "\\b(ENDCG)\\b",
            "endCaptures": {
                "1": {
                    "name": "keyword.other"
                }
            },
            "patterns": [
                {
                    "include": "#hlsl-embedded"
                }
            ]
        },
        {
            "name": "meta.hlslblock",
            "begin": "\\b(HLSLPROGRAM|HLSLINCLUDE)\\b",
            "beginCaptures": {
                "1": {
                    "name": "keyword.other"
                }
            },
            "end": "\\b(ENDHLSL)\\b",
            "endCaptures": {
                "1": {
                    "name": "keyword.other"
                }
            },
            "patterns": [
                {
                    "include": "#hlsl-embedded"
                }
            ]
        }
    ],
    "repository": {
        "comments": {
            "name": "comment.line.double-slash.shaderlab",
            "begin": "//",
            "end": "$"
        },
        "strings": {
            "name": "string.quoted.double.shaderlab",
            "begin": "\"",
            "end": "\""
        },
        "numbers": {
            "patterns": [
                {
                    "name": "constant.numeric.shaderlab",
                    "match": "\\b([0-9]+\\.?[0-9]*)\\b"
                }
            ]
        },
        "types": {
            "patterns": [
                {
                    "match": "\\b(fixed|float|int|half)([1-4](x[1-4])?)?\\b",
                    "name": "storage.type.basic.shaderlab"
                },
                {
                    "match": "\\bvoid\\b",
                    "name": "storage.type.basic.shaderlab"
                },
                {
                    "match": "\\b(sampler2D)\\b",
                    "name": "entity.name.type.class.shaderlab"
                },
                {
                    "match": ".*",
                    "name": "entity.name.type.struct.shaderlab"
                }
            ]
        },
        "paramsDefine": {
            "name": "meta.parameter.shaderlab",
            "match": "(out\\s+)?(\\w+)\\s+(\\w+)(?:\\s*:\\s*(\\w+))?",
            "captures": {
                "1": {
                    "name": "storage.type.basic.shaderlab"
                },
                "2": {
                    "patterns": [
                        {
                            "include": "#types"
                        }
                    ]
                },
                "3": {
                    "name": "support.variable.shaderlab"
                },
                "4": {
                    "patterns": [
                        {
                            "name": "constant.language.shaderlab",
                            "match": "VPOS|POSITION|SV_POSITION|NORMAL|SV_TARGET|TEXCOORD[0-9]"
                        }
                    ]
                }
            }
        },
        "functionDefine": {
            "name": "meta.function.shaderlab",
            "注释": "函数定义",
            "match": "(\\w+)\\s+(\\w+)\\s*\\((.*?)\\)(?:\\s*:\\s*(\\w+))?\\s*",
            "captures": {
                "1": {
                    "patterns": [
                        {
                            "include": "#types"
                        }
                    ]
                },
                "2": {
                    "name": "support.function.shaderlab"
                },
                "3": {
                    "patterns": [
                        {
                            "include": "#paramsDefine"
                        }
                    ]
                },
                "4": {
                    "name": "constant.language.shaderlab",
                    "match": "VPOS|POSITION|SV_POSITION|NORMAL|SV_TARGET|TEXCOORD[0-9]"
                }
            }
        },
        "structFieldDefine": {
            "patterns": [
                {
                    "match": "(\\w+)\\s+(\\w+(?:\\[\\d+\\])?)\\s*:\\s*(\\w+)",
                    "captures": {
                        "1": {
                            "patterns": [
                                {
                                    "include": "#types"
                                }
                            ]
                        },
                        "2": {
                            "name": "entity.name.variable.field.shaderlab",
                            "patterns": [
                                {
                                    "include": "#numbers"
                                }
                            ]
                        },
                        "3": {
                            "patterns": [
                                {
                                    "name": "constant.language.shaderlab",
                                    "match": "POSITION|SV_POSITION|NORMAL|SV_TARGET|TEXCOORD[0-9]"
                                }
                            ]
                        }
                    }
                }
            ]
        },
        "structDefine": {
            "patterns": [
                {
                    "name": "meta.struct",
                    "begin": "\\b(struct)\\b +\\b(\\S+)\\b",
                    "beginCaptures": {
                        "1": {
                            "name": "keyword.other.struct.shaderlab"
                        },
                        "2": {
                            "name": "entity.name.type.struct.shaderlab"
                        }
                    },
                    "end": "}",
                    "patterns": [
                        {
                            "include": "#comments"
                        },
                        {
                            "include": "#structFieldDefine"
                        }
                    ]
                }
            ]
        },
        "hlsl-embedded": {
            "patterns": [
                {
                    "include": "#comments"
                },
                {
                    "include": "#strings"
                },
                {
                    "include": "#numbers"
                },
                {
                    "match": "^\\s*(#pragma)\\s+(vertex|fragment)\\s+(\\w+)",
                    "captures": {
                        "1": {
                            "name": "keyword.define.shaderlab"
                        },
                        "2": {
                            "name": "keyword.type.shaderlab"
                        },
                        "3": {
                            "name": "support.function.hlsl"
                        }
                    }
                },
                {
                    "match": "^\\s*#pragma\\s+\\w+",
                    "name": "keyword.define.shaderlab"
                },
                {
                    "match": "^\\s*#\\w+",
                    "name": "keyword.define.shaderlab"
                },
                {
                    "match": "\\b(if|else|for|while|break|return|const|uniform)\\b",
                    "name": "keyword.control.shaderlab"
                },
                {
                    "include": "#functionDefine"
                },
                {
                    "注释": "带有分号的纯净变量声明",
                    "match": "(\\w+)\\s+(\\w+(?:\\[\\d*\\])?);",
                    "captures": {
                        "1": {
                            "patterns": [
                                {
                                    "include": "#types"
                                }
                            ]
                        },
                        "2": {
                            "name": "entity.name.variable.field.shaderlab",
                            "patterns": [
                                {
                                    "include": "#numbers"
                                }
                            ]
                        }
                    }
                },
                {
                    "注释": "函数调用",
                    "match": "(\\w+)\\s*\\(",
                    "captures": {
                        "1": {
                            "patterns": [
                                {
                                    "match": "\\b(fixed|float|int|half)([1-4](x[1-4])?)?\\b",
                                    "name": "storage.type.basic.shaderlab"
                                },
                                {
                                    "name": "support.function.shaderlab",
                                    "match": ".*"
                                }
                            ]
                        }
                    }
                },
                {
                    "include": "#structDefine"
                }
            ]
        }
    }
}
